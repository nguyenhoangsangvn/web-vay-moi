<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API TESTER - RIO FINTECH</title>
    <link rel="icon" type="image/png" href="https://img.icons8.com/color/48/data-configuration.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1e1e1e; color: #e0e0e0; font-family: monospace; padding: 20px; }
        .card { background: #2d2d2d; border: 1px solid #444; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; border: none; }
        .btn:hover { background: #0056b3; }
        .json-box { background: #000; color: #0f0; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 11px; height: 300px; border: 1px solid #333; }
        .status-ok { color: #4ade80; font-weight: bold; }
        .status-err { color: #ef4444; font-weight: bold; }
    </style>
</head>
<body>

    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
            <h1 class="text-2xl font-bold text-white">üß™ API CONNECTION TEST</h1>
            <button onclick="runTest()" class="btn">üöÄ G·ªåI API NGAY</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div>
                <h2 class="text-xl mb-2 text-blue-400">1. K·∫øt qu·∫£ hi·ªÉn th·ªã (Render)</h2>
                <p id="status-display" class="text-sm text-gray-400 mb-4">Tr·∫°ng th√°i: <span class="text-yellow-500">Ch·ªù l·ªánh...</span></p>
                <div id="render-area" class="grid grid-cols-1 gap-3">
                    </div>
            </div>

            <div>
                <h2 class="text-xl mb-2 text-green-400">2. D·ªØ li·ªáu g·ªëc t·ª´ Server (Debug)</h2>
                <p class="text-sm text-gray-400 mb-4">ƒê√¢y l√† ch√≠nh x√°c nh·ªØng g√¨ API tr·∫£ v·ªÅ:</p>
                <pre id="json-output" class="json-box">Ch∆∞a c√≥ d·ªØ li·ªáu...</pre>
            </div>
        </div>
    </div>

    <script>
        // C·∫§U H√åNH API
        const API_URL = 'https://publisher-api.riofintech.net/offer/all?pub_id=28janns&token=hpoRHLinw3JgcQaV6g6SaQ%3D%3D';
        
        // LINK MAP (V·∫´n c·∫ßn c√°i n√†y ƒë·ªÉ hi·ªán n√∫t ƒêƒÉng k√Ω, v√¨ API ko tr·∫£ v·ªÅ link)
        // N√≠ ƒëi·ªÅn link v√†o ƒë√¢y n·∫øu mu·ªën test n√∫t b·∫•m
        const LINK_MAP = {
            'moneycatvn': 'https://hl-link.net/nVT5020',
            'tima': 'https://hl-link.net/towLs20',
            // ... ƒëi·ªÅn th√™m n·∫øu c·∫ßn
        };

        const renderArea = document.getElementById('render-area');
        const jsonOutput = document.getElementById('json-output');
        const statusDisplay = document.getElementById('status-display');

        async function runTest() {
            // Reset giao di·ªán
            renderArea.innerHTML = '<div class="text-center py-10 animate-pulse">üì° ƒêang k·∫øt n·ªëi v·ªá tinh...</div>';
            jsonOutput.innerText = "ƒêang t·∫£i...";
            statusDisplay.innerHTML = 'Tr·∫°ng th√°i: <span class="text-yellow-400">ƒêang g·ªçi API qua Proxy...</span>';

            // D√πng nhi·ªÅu Proxy ƒë·ªÉ tƒÉng kh·∫£ nƒÉng th√†nh c√¥ng
            const proxies = [
                'https://corsproxy.io/?',
                'https://api.allorigins.win/get?url='
            ];

            let success = false;

            for (let proxy of proxies) {
                try {
                    let finalUrl = proxy + encodeURIComponent(API_URL);
                    console.log("Th·ª≠ URL:", finalUrl);

                    const res = await fetch(finalUrl);
                    if (!res.ok) throw new Error(`HTTP Error: ${res.status}`);

                    let rawData = await res.json();
                    
                    // X·ª≠ l√Ω ƒë·∫∑c bi·ªát cho AllOrigins
                    if (proxy.includes('allorigins')) {
                        rawData = JSON.parse(rawData.contents);
                    }

                    // In d·ªØ li·ªáu th√¥ ra m√†n h√¨nh ƒëen
                    jsonOutput.innerText = JSON.stringify(rawData, null, 2);

                    // B√≥c t√°ch d·ªØ li·ªáu
                    let list = extractData(rawData);

                    if (list.length > 0) {
                        statusDisplay.innerHTML = `Tr·∫°ng th√°i: <span class="status-ok">‚úÖ TH√ÄNH C√îNG (L·∫•y ƒë∆∞·ª£c ${list.length} offers)</span>`;
                        renderUI(list);
                        success = true;
                        break; // Tho√°t v√≤ng l·∫∑p n·∫øu th√†nh c√¥ng
                    } else {
                        throw new Error("API tr·∫£ v·ªÅ m·∫£ng r·ªóng []");
                    }

                } catch (e) {
                    console.error(e);
                    jsonOutput.innerText += `\n\n[L·ªói khi th·ª≠ Proxy]: ${e.message}`;
                }
            }

            if (!success) {
                renderArea.innerHTML = '<div class="p-4 bg-red-900/50 border border-red-500 rounded text-red-200">‚ùå TH·∫§T B·∫†I TO√ÄN T·∫¨P<br>Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn API RioFintech qua m·ªçi Proxy.<br>L√Ω do: Server ch·∫∑n ho·∫∑c Token h·∫øt h·∫°n.</div>';
                statusDisplay.innerHTML = 'Tr·∫°ng th√°i: <span class="status-err">‚ùå K·∫æT N·ªêI TH·∫§T B·∫†I</span>';
            }
        }

        // H√†m b√≥c t√°ch d·ªØ li·ªáu th√¥ng minh
        function extractData(raw) {
            // Tr∆∞·ªùng h·ª£p 1: [{ data: [...] }]
            if (Array.isArray(raw) && raw[0] && raw[0].data) return raw[0].data;
            // Tr∆∞·ªùng h·ª£p 2: { data: [...] }
            if (raw.data && Array.isArray(raw.data)) return raw.data;
            // Tr∆∞·ªùng h·ª£p 3: [...]
            if (Array.isArray(raw)) return raw;
            return [];
        }

        function renderUI(list) {
            renderArea.innerHTML = '';
            list.forEach(item => {
                let link = LINK_MAP[item.offer_id] || "#";
                let hasLink = link !== "#";
                
                let html = `
                    <div class="card flex gap-4 items-start">
                        <img src="${item.avatar || item.logo}" class="w-16 h-16 object-contain bg-white rounded p-1">
                        <div class="flex-1">
                            <h3 class="font-bold text-white text-lg">${item.name || item.offer_name}</h3>
                            <p class="text-xs text-gray-400 font-mono">ID: <span class="text-yellow-500">${item.offer_id}</span></p>
                            <p class="text-sm text-gray-300 mt-1 line-clamp-1">${cleanText(item.about || item.short_description)}</p>
                        </div>
                        <a href="${link}" target="_blank" class="btn ${hasLink ? 'bg-green-600' : 'bg-gray-600 cursor-not-allowed'}">
                            ${hasLink ? 'LINK OK' : 'NO LINK'}
                        </a>
                    </div>
                `;
                renderArea.insertAdjacentHTML('beforeend', html);
            });
        }

        function cleanText(html) {
            if(!html) return "Kh√¥ng c√≥ m√¥ t·∫£";
            let div = document.createElement("div");
            div.innerHTML = html;
            return div.innerText.substring(0, 100);
        }
    </script>
</body>
</html>
